## CVE-2021-31166
- Tested on Windows 10, version 21H1
- more: [click](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Encoding)
- [cve](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-31166)
- proof:
- ![](https://github.com/nu11secur1ty/Windows10Exploits/blob/master/CVE-2021-31166/docs/CVE-2021-31166-I-Love-Windows-10.gif)
- [.](https://github.com/0vercl0k/CVE-2021-31166)

- One-shot by nu11secur1ty

[1](https://streamable.com/5ka0zq)

## Docs and working records:

- - - When making a request to the URL

https://example.com/200
If a request is made to the server, and the header Accept-Encoding contains br as one of the options, the server returns extra binary content along with the request. This happens only for the 200 response, and only if the Accept-Encoding header is present and asks for br.

I did some examples in Python so that you can see the actual bytes returned:

>>> import requests
>>> requests.get('https://example.com/200', headers={'Accept': "application/json", 'Accept-Encoding': "br"}).content
b'\x83\x10\x80{"code": 200, "description": "OK"}\x03'
>>> requests.get('https://example.coms/200', headers={'Accept-Encoding': "br"}).content
b'\x83\x02\x80200 OK\x03'
>>> requests.post('https://example.com/200', headers={'Accept-Encoding': "br"}).content
b'\x83\x02\x80200 OK\x03'
>>> requests.post('https://example.com/200', headers={'Accept-Encoding': "gzip"}).content
b'200 OK'
>>> requests.post('https://example.com/200', headers={'Accept-Encoding': "gzip, deflate"}).content
b'200 OK'
>>> requests.post('https://example.com/200', headers={'Accept-Encoding': "gzip, deflate, br"}).content
b'\x83\x02\x80200 OK\x03'
>>> requests.post('https://example.com/403', headers={'Accept-Encoding': "gzip, deflate, br"}).content
b'403 Forbidden'
>>> 
The results are the same (albeit with ? for the non-ascii byte characters) when using curl:

% curl "https://example.com/200" -H "Accept-Encoding: br, gzip, deflate"
??200 OK%                                               
Obviously Accept-Encoding is not described anywhere as a supported header, so I don't expect it to be supported, but this behavior is a bit strange especially since only the 200 endpoint is affected. No other endpoints appear to display these extra bytes:

% curl "https://example.com/201" -H "Accept-Encoding: br, gzip, deflate"
201 Created%
% curl "https://example.com/302" -H "Accept-Encoding: br, gzip, deflate"
302 Found%
% curl "https://example.com/404" -H "Accept-Encoding: br, gzip, deflate"
404 Not Found%      
